---
title: "Logistic Regression"
date: "`r Sys.Date()`"
output: html_document
---

```{r global-options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE,
                   message=FALSE)
```

The goal of this exercise is to walk through a logistic regression analysis. It will give you a basic idea of the analysis steps and thought-process; however, due to class time constraints, this analysis is not exhaustive.

```{r load-packages}
library(tidyverse)
library(broom)
library(rms)
## add any other packages as needed 
```

This data is from an ongoing cardiovascular study on residents of the town of Framingham, Massachusetts. The goal is to predict whether a patient has a 10-year risk of future coronary heart disease. The dataset includes the following: 

- `male`: 0 = Female; 1 = Male
- `age`: Age at exam time.
- `education`: 1 = Some High School; 2 = High School or GED; 3 = Some College or Vocational School; 4 = College
- `currentSmoker`: 0 = nonsmoker; 1 = smoker
- `cigsPerDay`: number of cigarettes smoked per day (estimated average)
- `BPMeds`: 0 = Not on Blood Pressure medications; 1 = Is on Blood Pressure medications
- `prevalentStroke`: 0 = Stroke not prevalent in family history; 1 = Stroke prevalent in family history
- `prevalentHyp`: 0 = Hypertension not prevalent in family history; 1 = Hypertension prevalent in family history
- `diabetes`: 0 = No; 1 = Yes
- `totChol`: total cholesterol (mg/dL)
- `sysBP`: systolic blood pressure (mmHg)
- `diaBP`: diastolic blood pressure (mmHg)
- `BMI`: BodyMass Index calculated as: Weight (kg) / Height(meter-squared)
- `heartRate` Beats/Min (Ventricular)
- `glucose`: total glucose mg/dL
- `TenYearCHD`: 0 = Patient doesn't have 10-year risk of future coronary heart disease; 1 = Patient has 10-year risk of future coronary heart disease


```{r load-data}
fram_data <- read_csv("data/framingham.csv") %>%
  drop_na() %>%
  mutate(education = case_when(
    education == 1 ~ "Some HS", 
    education == 2 ~ "HS or GED", 
    education == 3 ~ "Some College", 
    education == 4 ~ "College"
  ),
  TenYearCHD = as.factor(TenYearCHD)
  )
```

- Fit a full model (main effects only) with `TenYearCHD` as the response. Display the model output. 

- Based on the goal of the analysis, should the full model be the final model? Why or why not? 

- Use the `step` function to conduct backward model selection. What is selection criteria used by the `step` function? 
    - Display the final model.

- Plot and analyze the ROC curve. Based on the ROC curve, does the model fit the data well?  Explain. 

- A doctor plans to use the results from your model to help select patients for a new heart disease prevention program. She asks you which threshold would be best to select patients for this program. What threshold would you recommend to the doctor? Why?
    

## References

- Data obtained from [https://www.kaggle.com/neisha/heart-disease-prediction-using-logistic-regression/data](https://www.kaggle.com/neisha/heart-disease-prediction-using-logistic-regression/data)